{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Quandary TOML Configuration Schema",
  "description": "Schema for Quandary quantum control configuration files",
  "type": "object",
  "required": ["system"],
  "properties": {
    "system": {
      "type": "object",
      "description": "System parameters for quantum simulation",
      "required": ["nlevels"],
      "properties": {
        "nlevels": {
          "type": "array",
          "description": "Number of levels per oscillator",
          "items": {
            "type": "integer",
            "minimum": 1
          },
          "minItems": 1
        },
        "nessential": {
          "type": "array",
          "description": "Number of levels per oscillator",
          "items": {
            "type": "integer",
            "minimum": 1
          },
          "minItems": 1
        },
        "ntime": {
          "type": "integer",
          "description": "Number of time steps",
          "minimum": 1
        },
        "dt": {
          "type": "number",
          "description": "Time step size",
          "exclusiveMinimum": 0
        },
        "transfreq": {
          "type": "array",
          "description": "Transition frequencies (GHz)",
          "items": {
            "type": "number"
          }
        },
        "selfkerr": {
          "type": "array",
          "description": "Self-Kerr anharmonicities",
          "items": {
            "type": "number"
          }
        },
        "crosskerr": {
          "type": "array",
          "description": "Cross-Kerr coupling strengths",
          "items": {
            "type": "number"
          }
        },
        "Jkl": {
          "type": "array",
          "description": "Dipole-dipole coupling strengths",
          "items": {
            "type": "number"
          }
        },
        "rotfreq": {
          "type": "array",
          "description": "Rotational wave approximation frequencies",
          "items": {
            "type": "number"
          }
        }
      },
      "additionalProperties": false
    },
    "optimization": {
      "type": "object",
      "description": "Optimization parameters",
      "properties": {
        "optim_target": {
          "description": "Optimization target specification",
          "oneOf": [
            {
              "type": "object",
              "description": "Gate target optimization",
              "required": ["target_type"],
              "properties": {
                "target_type": { "const": "gate" },
                "gate_type": {
                  "type": "string",
                  "description": "Type of gate to optimize for",
                  "enum": ["cnot", "hadamard", "xgate", "ygate", "zgate", "swap", "swap0q", "cqnot", "file"],
                  "default": "cnot"
                },
                "gate_file": {
                  "type": "string",
                  "description": "Path to gate file (when gate_type is 'file')"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Pure state target optimization",
              "required": ["target_type", "levels"],
              "properties": {
                "target_type": { "const": "pure" },
                "levels": {
                  "type": "array",
                  "description": "Target pure state levels for each oscillator",
                  "items": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "minItems": 1
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "File-based target optimization",
              "required": ["target_type", "filename"],
              "properties": {
                "target_type": { "const": "file" },
                "filename": {
                  "type": "string",
                  "description": "Path to target specification file"
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "optim_maxiter": {
          "type": "integer",
          "description": "Maximum optimization iterations",
          "minimum": 1,
          "default": 100
        },
        "optim_objective": {
          "type": "string",
          "description": "Objective function type",
          "enum": ["jfrobenius", "jtrace", "jmeasure"],
          "default": "jtrace"
        },
        "optim_regul": {
          "type": "number",
          "description": "Tikhonov regularization parameter",
          "minimum": 0,
          "default": 0.0
        },
        "optim_atol": {
          "type": "number",
          "description": "Absolute tolerance for optimization",
          "minimum": 0,
          "default": 1e-8
        },
        "optim_rtol": {
          "type": "number",
          "description": "Relative tolerance for optimization",
          "minimum": 0,
          "default": 1e-8
        },
        "optim_ftol": {
          "type": "number",
          "description": "Function tolerance for optimization",
          "minimum": 0,
          "default": 1e-8
        }
      },
      "additionalProperties": false
    },
    "control": {
      "type": "object",
      "description": "Control pulse parameters",
      "properties": {
        "control_segments": {
          "type": "object",
          "description": "Control parameterization per oscillator",
          "patternProperties": {
            "^[0-9]+$": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["bspline", "bspline0", "bsplineamp", "step"]
                  },
                  "nspline": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "tstart": {
                    "type": "number",
                    "minimum": 0
                  },
                  "tstop": {
                    "type": "number",
                    "minimum": 0
                  }
                }
              }
            }
          },
          "additionalProperties": false
        },
        "control_bounds": {
          "type": "object",
          "description": "Control amplitude bounds per oscillator",
          "patternProperties": {
            "^[0-9]+$": {
              "type": "array",
              "items": {
                "type": "number",
                "minimum": 0
              }
            }
          },
          "additionalProperties": false
        },
        "carrier_frequency": {
          "type": "object",
          "description": "Carrier frequencies per oscillator",
          "patternProperties": {
            "^[0-9]+$": {
              "type": "array",
              "items": {
                "type": "number"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "description": "Output and data parameters",
      "properties": {
        "datadir": {
          "type": "string",
          "description": "Output directory path",
          "default": "./"
        },
        "output_frequency": {
          "type": "integer",
          "description": "Frequency of data output",
          "minimum": 1,
          "default": 1
        },
        "optim_monitor_frequency": {
          "type": "integer",
          "description": "Frequency of optimization monitoring",
          "minimum": 0,
          "default": 0
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
